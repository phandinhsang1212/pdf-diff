function showZoom(e){let t=document.createElement("canvas"),l=t.getContext("2d");t.height=e.diff.height,t.width=e.diff.width;l.getImageData(0,0,t.width,t.height);let i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style["place-items"]="center",i.style.display="grid",document.getElementById("my_pdf_viewer").appendChild(i),t.style.display="block",t.style["max-width"]="100%",l.putImageData(e.diff,0,0),i.appendChild(t),document.getElementById("zoom_in").addEventListener("click",(i=>{null!=e.diff&&null!=e.diff&&(l.scale(1.5,1.5),l.drawImage(t,0,0))})),document.getElementById("zoom_out").addEventListener("click",(i=>{null!=e.diff&&null!=e.diff&&(l.scale(.5,.5),l.drawImage(t,0,0))})),$("#static-zoom").modal("toggle")}$(document).on("change","#switch-onoff-0",(function(){myState.diffPageOnly=$(this).prop("checked"),document.querySelectorAll(".same").forEach((e=>{e.classList.toggle("active")}))}));const div=document.getElementById("grid-result");var myState={CSS_UNITS:96/72,diffPageOnly:!1,file1:null,file2:null,img1:[],img2:[]};async function parsePageL(e){myState.file1=null,myState.img1=[];let t=await pdfjsLib.getDocument(e).promise;myState.file1=t;for(let e=1;e<=t.numPages;e++)t.getPage(e).then((async t=>{let l=t.getViewport({scale:1}),i=document.createElement("canvas"),a=i.getContext("2d"),n={canvasContext:a,viewport:l};i.height=l.height,i.width=l.width;const r=t.render(n);await r.promise.then((function(){let t=a.getImageData(0,0,i.width,i.height);if(myState.img1.push({key:e,value:t}),null==myState.file2){let l=document.createElement("div");l.style["grid-column-start"]=1,l.style["grid-row-start"]=e,document.getElementById("grid-result").appendChild(l);let n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.border="solid 1px var(--spectrum-global-color-gray-700)",n.style.position="relative",l.appendChild(n);let r=document.createElement("div");r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.background="var(--spectrum-global-color-gray-700)",r.style.color="rgb(255, 255, 255)",r.style.padding="0px 4px",r.textContent=`${e}`,n.appendChild(r);let o=document.createElement("div");o.style.width="100%",o.style.height="100%",o.style["place-items"]="center",o.style.display="grid",n.appendChild(o),i.style.display="block",i.style["max-width"]="100%",a.putImageData(t,0,0),o.appendChild(i)}}))}))}async function*parsePair(e,t){const l=[[0,0],...Array.from({length:9},((e,t)=>[[0,t+1],[t+1,0]])).flat()];let i=e,a=t;const n=i.numPages,r=a.numPages;let o,d;e:for(o=1,d=1;o<=n&&d<=r;){let e=null;for(const[t,s]of l){const l=o+t,c=d+s;if(l>n||c>r)continue;const[f,m]=await Promise.all([i.getPage(l).then((e=>{let t=e.getViewport({scale:1}),l=document.createElement("canvas"),i=l.getContext("2d");return l.height=t.height,l.width=t.width,e.render({canvasContext:i,viewport:t}).promise.then((function(){return i.getImageData(0,0,l.width,l.height)}))})),a.getPage(c).then((e=>{let t=e.getViewport({scale:1}),l=document.createElement("canvas"),i=l.getContext("2d");return l.height=t.height,l.width=t.width,e.render({canvasContext:i,viewport:t}).promise.then((function(){return i.getImageData(0,0,l.width,l.height)}))}))]),g=await imgDiff(f,m);if(0!==g.score){if(!("diff"in g))throw new Error("diffResult with non-zero score must have diff image data");if(!(g.score<1)){for(let e=o;e<l;e++)yield{left:e,right:void 0};for(let e=d;e<c;e++)yield{left:void 0,right:e};yield{left:l,right:c,...g},o=l+1,d=c+1;continue e}{const i=Math.max(0,g.score-.1*Math.max(t,s));(!e||i>e.score)&&(e={left:l,right:c,score:i,diff:g.diff})}}}if(e){const{left:t,right:l,diff:i,score:a}=e;for(let e=o;e<t;e++)yield{left:e,right:void 0};for(let e=d;e<l;e++)yield{left:void 0,right:e};yield{left:t,right:l,diff:i,score:a},o=t+1,d=l+1}else yield{left:o,right:void 0},yield{left:void 0,right:d},o+=1,d+=1}for(;o<=n;o++)yield{left:o,right:void 0};for(;d<=r;d++)yield{left:void 0,right:d}}async function imgDiff(e,t){const{width:l,height:i}=e;if(l!==t.width||i!==t.height)return{score:0};const a=new Uint8Array(l*i*4);return{score:1-pixelmatch(e.data,t.data,a,l,i)/(l*i),diff:new ImageData(new Uint8ClampedArray(a),l,i)}}function renderMid(e,t){return new Promise((l=>{if(null!=e.diff&&null!=e.diff){let l=document.createElement("canvas");l.width=e.diff.width,l.height=e.diff.height;let i=l.getContext("2d");i.canvas.style.display="block",i.canvas.style["max-width"]="100%",i.putImageData(e.diff,0,0);let a=document.createElement("div");a.style["grid-column-start"]=2,a.style["grid-row-start"]=t,a.setAttribute("class",1==myState.diffPageOnly?1==e.score?"grid-col same":"grid-col diff":1==e.score?"grid-col same active":"grid-col diff"),a.onclick=function(){showZoom(e)},div.appendChild(a);let n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.border=1==e.score?"solid 1px var(--spectrum-global-color-green-700)":"solid 1px var(--spectrum-global-color-red-700)",n.style.position="relative",a.appendChild(n);let r=document.createElement("div");r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.background=1==e.score?"var(--spectrum-global-color-green-700)":"var(--spectrum-global-color-red-700)",r.style.color="rgb(255, 255, 255)",r.style.padding="0px 4px",r.textContent=1==e.score?"Match":"Difference",n.appendChild(r);let o=document.createElement("div");o.style.width="100%",o.style.height="100%",o.style["place-items"]="center",o.style.display="grid",n.appendChild(o),o.appendChild(i.canvas)}else writeNA(2,t);l()}))}function renderLeft(e,t){return new Promise((l=>{if(null!=e.left){let l=myState.img1.find((t=>t.key==e.left)),i=document.createElement("canvas");i.width=l.value.width,i.height=l.value.height;let a=i.getContext("2d");a.canvas.style.display="block",a.canvas.style["max-width"]="100%",a.putImageData(l.value,0,0);let n=document.createElement("div");n.style["grid-column-start"]=1,n.style["grid-row-start"]=t,n.setAttribute("class",1==myState.diffPageOnly?1==e.score?"grid-col same":null==e.right?"":"grid-col diff":1==e.score?"grid-col same active":null==e.right?"":"grid-col diff"),div.appendChild(n);let r=document.createElement("div");r.style.width="100%",r.style.height="100%",r.style.border="solid 1px var(--spectrum-global-color-gray-700)",r.style.position="relative",n.appendChild(r);let o=document.createElement("div");o.style.position="absolute",o.style.left="0px",o.style.top="0px",o.style.background="var(--spectrum-global-color-gray-700)",o.style.color="rgb(255, 255, 255)",o.style.padding="0px 4px",o.textContent=`${e.left}`,r.appendChild(o);let d=document.createElement("div");d.style.width="100%",d.style.height="100%",d.style["place-items"]="center",d.style.display="grid",r.appendChild(d),d.appendChild(a.canvas)}else writeNA(1,t);l()}))}function renderRight(e,t){return new Promise((l=>{if(null!=e.right){let l=myState.img2.find((t=>t.key==e.right)),i=document.createElement("canvas");i.width=l.value.width,i.height=l.value.height;let a=i.getContext("2d");a.canvas.style.display="block",a.canvas.style["max-width"]="100%",a.putImageData(l.value,0,0);let n=document.createElement("div");n.style["grid-column-start"]=3,n.style["grid-row-start"]=t,n.setAttribute("class",1==myState.diffPageOnly?1==e.score?"grid-col same":null==e.left?"":"grid-col diff":1==e.score?"grid-col same active":null==e.left?"":"grid-col diff"),div.appendChild(n);let r=document.createElement("div");r.style.width="100%",r.style.height="100%",r.style.border="solid 1px var(--spectrum-global-color-gray-700)",r.style.position="relative",n.appendChild(r);let o=document.createElement("div");o.style.position="absolute",o.style.left="0px",o.style.top="0px",o.style.background="var(--spectrum-global-color-gray-700)",o.style.color="rgb(255, 255, 255)",o.style.padding="0px 4px",o.textContent=`${e.right}`,r.appendChild(o);let d=document.createElement("div");d.style.width="100%",d.style.height="100%",d.style["place-items"]="center",d.style.display="grid",r.appendChild(d),d.appendChild(a.canvas)}else writeNA(3,t);l()}))}async function writeResultToPage(e,t){await Promise.all([renderMid(e,t),renderLeft(e,t),renderRight(e,t)])}function writeNA(e,t){let l=document.createElement("div");l.style["grid-column-start"]=e,l.style["grid-row-start"]=t,div.appendChild(l);let i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.border="solid 1px #6e6e6e",i.style.position="relative",l.appendChild(i);let a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style["place-items"]="center",a.style.display="grid",i.appendChild(a);let n=document.createElement("span");n.style.color="#6e6e6e",n.textContent="N/A",a.appendChild(n)}async function parsePageR(e){myState.file2=null,myState.img2=[];let t=await pdfjsLib.getDocument(e).promise;myState.file2=t;for(let e=1;e<=t.numPages;e++)t.getPage(e).then((async t=>{let l=t.getViewport({scale:1}),i=document.createElement("canvas"),a=i.getContext("2d"),n={canvasContext:a,viewport:l};i.height=l.height,i.width=l.width;const r=t.render(n);await r.promise.then((function(){let t=a.getImageData(0,0,i.width,i.height);if(myState.img2.push({key:e,value:t}),null==myState.file1){let l=document.createElement("div");l.style["grid-column-start"]=3,l.style["grid-row-start"]=e,document.getElementById("grid-result").appendChild(l);let n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.border="solid 1px var(--spectrum-global-color-gray-700)",n.style.position="relative",l.appendChild(n);let r=document.createElement("div");r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.background="var(--spectrum-global-color-gray-700)",r.style.color="rgb(255, 255, 255)",r.style.padding="0px 4px",r.textContent=`${e}`,n.appendChild(r);let o=document.createElement("div");o.style.width="100%",o.style.height="100%",o.style["place-items"]="center",o.style.display="grid",n.appendChild(o),i.style.display="block",i.style["max-width"]="100%",a.putImageData(t,0,0),o.appendChild(i)}}))}))}const defaultOptions={threshold:1e-24,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function pixelmatch(e,t,l,i,a,n){if(!isPixelData(e)||!isPixelData(t)||l&&!isPixelData(l))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(e.length!==t.length||l&&l.length!==e.length)throw new Error("Image sizes do not match.");if(e.length!==i*a*4)throw new Error("Image data size does not match width/height.");n=Object.assign({},defaultOptions,n);const r=i*a,o=new Uint32Array(e.buffer,e.byteOffset,r),d=new Uint32Array(t.buffer,t.byteOffset,r);let s=!0;for(let e=0;e<r;e++)if(o[e]!==d[e]){s=!1;break}if(s){if(l&&!n.diffMask)for(let t=0;t<r;t++)drawGrayPixel(e,4*t,n.alpha,l);return 0}const c=35215*n.threshold*n.threshold;let f=0;for(let r=0;r<a;r++)for(let o=0;o<i;o++){const d=4*(r*i+o),s=colorDelta(e,t,d,d);Math.abs(s)>c?n.includeAA||!antialiased(e,o,r,i,a,t)&&!antialiased(t,o,r,i,a,e)?(l&&drawPixel(l,d,...s<0&&n.diffColorAlt||n.diffColor),f++):l&&!n.diffMask&&(drawPixel(l,d,...s<0&&n.diffColorAlt||n.diffColor),f++):l&&(n.diffMask||drawGrayPixel(e,d,n.alpha,l))}return f}function isPixelData(e){return ArrayBuffer.isView(e)&&1===e.constructor.BYTES_PER_ELEMENT}function antialiased(e,t,l,i,a,n){const r=Math.max(t-1,0),o=Math.max(l-1,0),d=Math.min(t+1,i-1),s=Math.min(l+1,a-1),c=4*(l*i+t);let f,m,g,y,h=t===r||t===d||l===o||l===s?1:0,u=0,p=0;for(let a=r;a<=d;a++)for(let n=o;n<=s;n++){if(a===t&&n===l)continue;const r=colorDelta(e,e,c,4*(n*i+a),!0);if(0===r){if(h++,h>2)return!1}else r<u?(u=r,f=a,m=n):r>p&&(p=r,g=a,y=n)}return 0!==u&&0!==p&&(hasManySiblings(e,f,m,i,a)&&hasManySiblings(n,f,m,i,a)||hasManySiblings(e,g,y,i,a)&&hasManySiblings(n,g,y,i,a))}function hasManySiblings(e,t,l,i,a){const n=Math.max(t-1,0),r=Math.max(l-1,0),o=Math.min(t+1,i-1),d=Math.min(l+1,a-1),s=4*(l*i+t);let c=t===n||t===o||l===r||l===d?1:0;for(let a=n;a<=o;a++)for(let n=r;n<=d;n++){if(a===t&&n===l)continue;const r=4*(n*i+a);if(e[s]===e[r]&&e[s+1]===e[r+1]&&e[s+2]===e[r+2]&&e[s+3]===e[r+3]&&c++,c>2)return!0}return!1}function colorDelta(e,t,l,i,a){let n=e[l+0],r=e[l+1],o=e[l+2],d=e[l+3],s=t[i+0],c=t[i+1],f=t[i+2],m=t[i+3];if(d===m&&n===s&&r===c&&o===f)return 0;d<255&&(d/=255,n=blend(n,d),r=blend(r,d),o=blend(o,d)),m<255&&(m/=255,s=blend(s,m),c=blend(c,m),f=blend(f,m));const g=rgb2y(n,r,o),y=rgb2y(s,c,f),h=g-y;if(a)return h;const u=rgb2i(n,r,o)-rgb2i(s,c,f),p=rgb2q(n,r,o)-rgb2q(s,c,f),w=.5053*h*h+.299*u*u+.1957*p*p;return g>y?-w:w}function rgb2y(e,t,l){return.29889531*e+.58662247*t+.11448223*l}function rgb2i(e,t,l){return.59597799*e-.2741761*t-.32180189*l}function rgb2q(e,t,l){return.21147017*e-.52261711*t+.31114694*l}function blend(e,t){return 255+(e-255)*t}function drawPixel(e,t,l,i,a){e[t+0]=l,e[t+1]=i,e[t+2]=a,e[t+3]=255}function drawGrayPixel(e,t,l,i){const a=blend(rgb2y(e[t+0],e[t+1],e[t+2]),l*e[t+3]/255);drawPixel(i,t,a,a,a)}function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?document.getElementById("movetop").style.display="block":document.getElementById("movetop").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}window.onscroll=function(){scrollFunction()},$("#file1").FancyFileUpload({params:{action:"fileuploader"},maxfilesize:25e6,added:async function(e,t){var l=await t[0].arrayBuffer();if(await parsePageL(l),null!=myState.file1&&null!=myState.file1&&null!=myState.file2&&null!=myState.file2){let e=1;div.innerHTML="",(async()=>{for await(const t of parsePair(myState.file1,myState.file2))writeResultToPage(t,e),e++})()}},deleted:function(e,t){}}),$("#file2").FancyFileUpload({params:{action:"fileuploader"},maxfilesize:25e6,added:async function(e,t){var l=await t[0].arrayBuffer();if(await parsePageR(l),null!=myState.file1&&null!=myState.file1&&null!=myState.file2&&null!=myState.file2){let e=1;div.innerHTML="",(async()=>{for await(const t of parsePair(myState.file1,myState.file2))await writeResultToPage(t,e),e++})()}},deleted:function(e,t){}});